{% extends 'dashboard.html' %}

{% block breadcrumbs %}  
<div style='display:flex; flex-direction: column; width:100%; margin-right:20px; margin-bottom:-16px;'>
    <div style='display:flex; margin-bottom:20px; text-transform: uppercase;'> 
        <span>SEO Tools</span>
        <span>Guest Posting</span>   
    </div>        
    <h1 class='az-content-title'>Guest Posting</h1>
</div>    
{% endblock %}    

{% block tool_content %} 
    {% if acess_flag_guest_posting %} 
<style>   
.GUEST-POSTING_Root{
    width         : 100%;
    height        : 100%;
    flex-grow     : 1;   
    display       : flex;
    flex-direction: column;
    padding       : 10 10 10 10;
    gap           : 20px;
   
}
.GUEST-POSTING_Stopped-Loader {
    border        : 4px solid lightgrey;
    border-radius : 50%;        
    width         : 28px;
    height        : 28px;            
    margin-left   : 0px;
    margin-top    : 0;     
    display       : flex;               
}
.GUEST-POSTING_Pool-Dialog{
    position         : absolute;
    display          : none;
    flex-direction   : column;
    z-index          : 3;
    background-color : var(--theme-clr-weak);
    border           : 1px solid var(--theme-clr-strong);
    gap              : 6px;
    padding          : 6 6 6 6;
    width            : 400px;
}  
</style>    

<div class='GUEST-POSTING_Root'>
    <div class='GUEST-POSTING_Pool-Dialog' id='GUEST-POSTING::Pool-Dialog'>
        <div class='az-content-label mg-b-5;' style='margin-bottom:0x;margin-top:0px'>Generating guest POST</div>
        <div id='GUEST-POSTING::progress-searcher-container' style='display:flex;gap:6px'>
            <div><div class='GUEST-POSTING_Stopped-Loader'></div></div>
            <p style='margin-top:4px'>Generating Semantic Analysis</p>
        </div>
        <div id='GUEST-POSTING::progress-outline-container' style='display:flex;gap:6px'>
            <div><div class='GUEST-POSTING_Stopped-Loader'></div></div>
            <p style='margin-top:4px'>Creating Outline</p>
        </div>        
        <div id='GUEST-POSTING::progress-article-container' style='display:flex;gap:6px'>
            <div><div class='GUEST-POSTING_Stopped-Loader'></div></div>
            <p style='margin-top:4px'>Creating Article</p>
        </div>        
        <div id='GUEST-POSTING::progress-fix-container' style='display:flex;gap:6px'>
            <div><div class='GUEST-POSTING_Stopped-Loader'></div></div>
            <p style='margin-top:4px'>Fixing Article</p>
        </div>
        <div id='GUEST-POSTING::progress-titles-container' style='display:flex;gap:6px'>
            <div><div class='GUEST-POSTING_Stopped-Loader'></div></div>
            <p style='margin-top:4px'>Generating Title Suggestions</p>
        </div>
        <div style='display:none;gap:6px;flex-direction:row-reverse;'>
            <button class='btn btn-danger btn-rounded'>Cancel</button>
        </div>
    </div>
    <div class='GUEST-POSTING_Pool-Dialog' style='flex-direction:column;width:900px;' name='DASHBOARD::hide-me' id='GUEST-POSTING::Title-Dialog'>
        <div style='display:flex;' onclick="event.stopPropagation()">
            <div style='display:flex;flex-direction:column; width:33%; gap:6px; margin-bottom:16px; margin-top:8px;'>
                <div class='az-content-label mg-b-5;' style='margin-bottom:0x;margin-top:0px'>Suggestion 1</div>  
                <input id='GUEST-POSTING::article-title1' type='text' class='form-control' placeholder='Title' style='margin: 0 0 0 0'></input>   
                <textarea id='GUEST-POSTING::meta-desc1' type='text' class='form-control' rows=6 placeholder='Meta-description' style='margin: 4 0 0 0'></textarea>            
                <div style='display:flex;flex-direction:row-reverse;margin-top:2px; gap:6px'>
                    <button class='btn btn-primary btn-rounded' onClick='GUESTPOSTING_Accept(1)'>Accept</button>                        
                </div>
            </div>    
            <div style='display:flex;flex-direction:column; width:33%; gap:6px; margin-bottom:16px; margin-top:8px;'>
                <div class='az-content-label mg-b-5;' style='margin-bottom:0x;margin-top:0px'>Suggestion 2</div>  
                <input id='GUEST-POSTING::article-title2' type='text' class='form-control' placeholder='Title' style='margin: 0 0 0 0'></input>   
                <textarea id='GUEST-POSTING::meta-desc2' type='text' class='form-control' rows=6 placeholder='Meta-description' style='margin: 4 0 0 0'></textarea>            
                <div style='display:flex;flex-direction:row-reverse;margin-top:2px'>
                    <button class='btn btn-primary btn-rounded' onClick='GUESTPOSTING_Accept(2)'>Accept</button>
                </div>
            </div>    
            <div style='display:flex;flex-direction:column; width:33%; gap:6px; margin-bottom:16px; margin-top:8px;'>
                <div class='az-content-label mg-b-5;' style='margin-bottom:0x;margin-top:0px'>Suggestion 3</div>  
                <input id='GUEST-POSTING::article-title3' type='text' class='form-control' placeholder='Title' style='margin: 0 0 0 0'></input>   
                <textarea id='GUEST-POSTING::meta-desc3' type='text' class='form-control' rows=6 placeholder='Meta-description' style='margin: 4 0 0 0'></textarea>            
                <div style='display:flex;flex-direction:row-reverse;margin-top:2px'>
                    <button class='btn btn-primary btn-rounded' onClick='GUESTPOSTING_Accept(3)'>Accept</button>
                </div>
            </div>    
        </div>    
        <div style='display:flex;flex-direction:row-reverse;margin-top:6px; gap:16px; border-top: 1px solid #6f42c1;' onclick="event.stopPropagation()">            
            <button class='btn btn-primary btn-rounded' id='GUEST-POSTING::gen-title' 
                style="margin-top:6px" onClick='GUESTPOSTING_GenTitleSuggestions(event)'>Generate suggestions</button>
            <div id='GUEST-POSTING::title-spinner' class='DASHBOARD_Loader' style='width:36px; height:36px; margin-top:8px; margin-right: 12px;'></div>
            <div style='display:flex;gap:10px;margin-top:6px' onclick="event.stopPropagation()">        
                <select id='GUEST-POSTING::title-and-meta-prompts' class="form-control select2-no-search select2-hidden-accessible" 
                    style="width:200px" onclick="event.stopPropagation()">                             
                </select> 
            </div> 
            <div class='az-content-label mg-b-5' style='margin-bottom:2px;margin-top:12px;margin-right:-12px'>Prompt</div>                 
        </div>
    </div>

    <div style='display:flex; gap:20px'>
        <div style='display:flex;flex-direction:column; width:25%;'>              
            <div class='az-content-label mg-b-5;' style='margin-bottom:2px;margin-top:0px'>Anchor text</div>
            <input id='GUEST-POSTING::anchor-text' type='text' class='form-control' placeholder='Anchor Text' style='margin: 0 0 0 0'></input> 
            <div class='az-content-label mg-b-5;' style='margin-bottom:2px;margin-top:10px'>Target URL</div>
            <input id='GUEST-POSTING::target-url' type='text' class='form-control' placeholder='Target URL' style='margin: 0 0 0 0'></input> 
            <div class='az-content-label mg-b-5;' style='margin-bottom:2px;margin-top:10px'>Topic</div>
            <input id='GUEST-POSTING::topic' type='text' class='form-control' placeholder='Topic of content' style='margin: 0 0 0 0'></input>  
            <div style='display:flex;gap:4px'>
                <div style=display:flex;flex-direction:column>
                    <div class='az-content-label mg-b-5' style='margin-bottom:2px;margin-top:10px;'>Fix Prompts</div>   
                    <div style='display:flex; gap:10px'>        
                        <select id='GUEST-POSTING::fix-prompts' class="form-control select2-no-search select2-hidden-accessible" style="width:200px"
                        onchange='GUESTPOSTING_FixPromptChanged(this)'>                             
                        </select> 
                    </div> 
                </div>     
                <div style=display:flex;flex-direction:column>
                    <div class='az-content-label mg-b-5' style='margin-bottom:3px;margin-top:10px;font-size:13px;'>Outline\Article Prompts</div>   
                    <div style='display:flex; gap:10px'>        
                        <select id='GUEST-POSTING::outline-and-article-prompts' class="form-control select2-no-search select2-hidden-accessible" 
                        onchange='GUESTPOSTING_OutlinePromptChanged(this)'>
                        style="width:200px">                             
                        </select> 
                    </div> 
                </div>   
            </div>           
        </div> 
        <div style='display:flex;flex-direction:column; width:25%;'>
            <div class='az-content-label mg-b-5;' style='margin-bottom:2px;margin-top:0px'>Title and meta description</div>  
            <input id='GUEST-POSTING::article-title' type='text' class='form-control' placeholder='Title' style='margin: 0 0 0 0'></input>   
            <textarea id='GUEST-POSTING::meta-desc' type='text' class='form-control' rows=6 placeholder='Meta-description' style='margin: 4 0 0 0'></textarea>            
            <div style='display:flex;flex-direction:row-reverse;margin-top:6px'>
                <button class='btn btn-primary btn-rounded' onClick='GUESTPOSTING_ShowTitleDiag(event)'>AI suggestions</button>
            </div>
        </div>   
        <div style='display:flex;flex-direction:column;width:25%;position:relative'>
            <div style='display:flex; gap:6px'>
                <div class='az-content-label mg-b-5'>Audiences</div>
                <p class='mg-b-20' style='margin-bottom:0px;margin-top:-4px;padding:0 0 0 0'>Select one</p>   
            </div>          
            <select id='GUEST-POSTING::audiences-container' class="form-control" size='10' style='height:232px' onChange='GUESTPOSTING_AudienceChanged()'>
                <template id='GUEST-POSTING::audiences-template'>                                
                    <option value="..." onmouseenter='GUESTPOSTING_ShowAudienceTip(this)' 
                        onmouseleave="document.getElementById('GUEST-POSTING::audience-tip').style.display = 'none'">Whatever
                    </option>
                </template>                  
            </select>  
            <div id='GUEST-POSTING::audience-tip' style='position:absolute; top:260px; display:none; background-color:#6f42c1ff; color:white; width:100%;
                padding:20 20 20 20; word-wrap: normal; z-index:1'>               
            </div>
        </div>   
        <div style='display:flex;flex-direction:column;width:25%;position:relative'>
            <div style='display:flex; gap:6px'>
                <div class='az-content-label mg-b-5'>Tones</div>
                <p class='mg-b-20' style='margin-bottom:0px;margin-top:-4px;padding:0 0 0 0'>Select one or two</p>   
            </div>          
            <select id='GUEST-POSTING::tones-container' class="form-control" size='10' style='height:232px' onChange='GUESTPOSTING_ToneChanged()'>
                <template id='GUEST-POSTING::tones-template'>                                
                    <option value="..." onmouseenter='GUESTPOSTING_ShowToneTip(this)' 
                        onmouseleave="document.getElementById('GUEST-POSTING::tone-tip').style.display = 'none'">Whatever
                    </option>
                </template>                  
            </select>  
            <div id='GUEST-POSTING::tone-tip' style='position:absolute; top:260px; display:none; background-color:#6f42c1ff; color:white; width:100%;
                padding:20 20 20 20; word-wrap: normal; z-index:1'>               
            </div>
        </div>                 
    </div>    
    <div style='display:flex; gap:20px;margin-top:14px;'>
        <div style='display:flex;flex-direction:column; width:25%; gap:4px'>
            <div class='az-content-label mg-b-5;' style='margin-bottom:10px'>Special Instructions Outline</div>
            <textarea id='GUEST-POSTING::instructions-outline' class='form-control' placeholder='Special Instructions Outline' rows="15" style='margin: 0 0 0 0'></textarea> 
            <div style='display:flex;flex-direction:row-reverse;margin-top:2px; gap:6px'>
                <button class='btn btn-primary btn-rounded' onClick='GUESTPOSTING_SetDefault(this, "Outline")'>Set as default</button>                        
            </div> 
        </div> 
        <div style='display:flex;flex-direction:column; width:25%; gap:4px'>
            <div class='az-content-label mg-b-5;' style='margin-bottom:10px'>Special Instructions Content</div>
            <textarea id='GUEST-POSTING::instructions-article' class='form-control' placeholder='Special Instructions Content' rows="15" style='margin: 0 0 0 0'></textarea> 
            <div style='display:flex;flex-direction:row-reverse;margin-top:2px; gap:6px'>
                <button class='btn btn-primary btn-rounded' onClick='GUESTPOSTING_SetDefault(this, "Article")'>Set as default</button>                        
            </div>  
        </div>    
        <div style='display:flex;flex-direction:column; width:25%'>
            <div class='az-content-label mg-b-5;' style='margin-bottom:10px'>Blacklist exclusions</div>
            <textarea id='GUEST-POSTING::black-list-exlusions' class='form-control' placeholder='Blacklist exclusions' 
            rows="17" style='margin: 0 0 0 0' onkeydown='GUESTPOSTING_BlackListExclusionsChanged(this)'></textarea></textarea>  
        </div>      
        <div style='display:flex;flex-direction:column; width:25%'>
            <div class='az-content-label mg-b-5;' style='margin-bottom:10px'>Generated content</div>
            <textarea id='GUEST-POSTING::generated-content' class='form-control' placeholder='Generated content' rows="17" style='margin: 0 0 0 0'></textarea>  
        </div> 
    </div>
    <!--<div class='spacer'></div>-->    
    <div style='display:flex;flex-direction:row-reverse;gap:2px'>
        <button id='GUEST-POSTING::Generate' class='btn btn-az-secondary btn-rounded' style='margin-left: 20px;'>Generate - Auto</button>  
        <button id='GUEST-POSTING::redo' class='btn btn-az-secondary btn-rounded' style='display:flex;padding-top:12px;' disabled>                  
            <i class="fa fa-undo" aria-hidden="true"></i>
            <div style='margin-left:6px;' id='GUEST-POSTING::redo-label'></div> 
        </button>    
        <button id='GUEST-POSTING::generate-manual' class='btn btn-az-secondary btn-rounded' style='display:flex;' onclick='GUESTPOSTING_StartManual()'>        
            <div id='GUEST-POSTING::generate-manual-label'>Generate - manual</div> 
            <div id='GUEST-POSTING::generate-manual-spinner' class='DASHBOARD_Loader' style='width:26px; height:26px; margin-top:-4px;'></div>             
        </button>  
        <div style="margin:0 10 10 0; padding-left:2px; display:flex;gap:6px; border-bottom:2px solid #3366ff">
            <input id='GUEST-POSTING::highlight-after-improve' type="checkbox" style="margin:0 0 0 0"></input>
            <div style='padding-top:5px;'>Highlight important terms</div>
        </div>        
    </div>
 </div>

<script>
    var GUESTPOSTING = {
        __Descriptions             : {Tones : {}, Audiences : {}},
        SetToneDescription(tone, desc) {
            this.__Descriptions.Tones[tone.replaceAll("-", ' ')] = desc;
        },
        SetAudienceDescription(audience, desc) {
            this.__Descriptions.Audiences[audience.replaceAll("-", ' ')] = desc;
        },
        GetToneDescription(tone) {
            return this.__Descriptions.Tones[tone.replaceAll("-", ' ')];
        },
        GetAudienceDescription(audience) {
            return this.__Descriptions.Audiences[audience.replaceAll("-", ' ')];
        },
    }
    document.getElementById('GUEST-POSTING::Generate').onclick = async function(){
        this.disabled = true;
        await DASHBOARD_UpdateSettings()        
        for (const _id of ['article-title', 'anchor-text', 'target-url', 'meta-desc']) {
            if (document.getElementById(`GUEST-POSTING::${_id}`).value === '') {
                alert(`No "${_id.replace('-', ' ')}" provided`);
                this.disabled = false;
                return;
            }
        }
        if (DASHBOARD_GetOptions('GUEST-POSTING::audiences-container').length === 0) {
            alert('Please select the audience');
            this.disabled = false;
            return;
        }
        if (DASHBOARD_GetOptions('GUEST-POSTING::tones-container').length === 0) {
            alert('Please select the tone');
            this.disabled = false;
            return; 
        }
        let templates     = DASHBOARD_OptionO('More Prompts')['Fix content'][document.getElementById('GUEST-POSTING::fix-prompts').value];            
        let template_vars = {
            TONES    : DASHBOARD_OptionA('Selected Tones'),
            AUDIENCE : DASHBOARD_Option('Selected Audience')
        }
        let prompts   = {
            'AI Words - System'         : DASHBOARD_ExpandPrompt(template_vars, templates[0]),
            'AI Words - User'           : DASHBOARD_ExpandPrompt(template_vars, templates[1]),
            'Self referencing - System' : DASHBOARD_ExpandPrompt(template_vars, templates[2]),
            'Self referencing - User'   : DASHBOARD_ExpandPrompt(template_vars, templates[3]),
            'Bold words - System'       : DASHBOARD_ExpandPrompt(template_vars, templates[4]),
            'Bold words - User'         : DASHBOARD_ExpandPrompt(template_vars, templates[5]),
        }  
        let options = DASHBOARD_FetchOPtions();
        options.body = JSON.stringify({
            'Highlight'             : document.getElementById('GUEST-POSTING::highlight-after-improve').checked === true ? 'HIGHLIGHT' : '',    
            'HModel'                : DASHBOARD_GetModel('highlight'),  
            'MetaDescription'       : document.getElementById('GUEST-POSTING::meta-desc').value,
            'ArticleTitle'          : document.getElementById('GUEST-POSTING::article-title').value,
            'AnchorText'            : document.getElementById('GUEST-POSTING::anchor-text').value,
            'TargetURL'             : document.getElementById('GUEST-POSTING::target-url').value,
            'Audience'              : DASHBOARD_GetOptions('GUEST-POSTING::audiences-container')[0],
            'Tones'                 : DASHBOARD_GetOptions('GUEST-POSTING::tones-container')[0],
            'SpecialInstructions'   : {
                'Outline' : document.getElementById('GUEST-POSTING::instructions-outline').value,
                'Content' : document.getElementById('GUEST-POSTING::instructions-article').value
            },
            Models : {
                'Outline'  : DASHBOARD_GetModel('outline-generation'),
                'Article'  : DASHBOARD_GetModel('guest-article'),    
                'Entities' : DASHBOARD_GetModel('Entities'),
                'Fix'      : DASHBOARD_GetModel('black-list'),
                'Improve'  : DASHBOARD_GetModel('improve-content'),
                'Model2ndPass' : DASHBOARD_GetModel('black-list-2nd'), 
                SelfReferecing : DASHBOARD_GetModel('self-referecing'),                
            },
            Model  : DASHBOARD_GetModel('black-list'),
            IModel : DASHBOARD_GetModel('improve-content'),           
            Today                  : new Date().toDateString().split(' ').slice(1, 4).toString().replace(',', ' ').replace(',', ', '),
            GuestPostingPrompts    : await GUESTPOSTING_GetPrompts(), 
            Prompts                : prompts,
            BlackListExclusions    : document.getElementById('GUEST-POSTING::black-list-exlusions').value.replaceAll("\n", '@')
        });
        DASHBOARD_Fetch('/guest-post-create', options);
        while ((await DASHBOARD_Fetch('/pool?id=GuestPost&CleanUP=true', options)).Err !== 'S_OK') {
            await new Promise(resolve => setTimeout(resolve, 100));
        }           
        GUESTPOSTING_Pool()
        this.disabled = false;
    };
    (async function(){  
        console.log(DASHBOARD_Cookie('GUESTPOSTING::FixPrompt'))               
        await DASHBOARD_UpdateSettings()  
        let select       = document.getElementById('GUEST-POSTING::fix-prompts')
        select.innerHTML = ''        
        for (const prompt in DASHBOARD_OptionO('More Prompts')['Fix content']){            
            let option      = document.createElement('option');
            option.value    = prompt;
            option.label    = prompt;              
            select.appendChild(option);
        }     
        select           = document.getElementById('GUEST-POSTING::outline-and-article-prompts')
        select.innerHTML = ''        
        for (const prompt in DASHBOARD_OptionO('More Prompts')['Guest posting']){            
            let option      = document.createElement('option');
            option.value    = prompt;
            option.label    = prompt;              
            select.appendChild(option);
        }  
        DASHBOARD_SetOptions('GUEST-POSTING::fix-prompts', DASHBOARD_Cookie('GUESTPOSTING::FixPrompt'))           
        DASHBOARD_SetOptions('GUEST-POSTING::outline-and-article-prompts', DASHBOARD_Cookie('GUESTPOSTING::OutlineAndArticlePrompt'))   
        document.getElementById('GUEST-POSTING::black-list-exlusions').value = DASHBOARD_Cookie('GUESTPOSTING::BlackListExclusions').replaceAll('@', "\n");            
        let reply = await (await fetch(`/guest-post_get-defaults?SettingsID=${DASHBOARD_GUID('Settings')}`, DASHBOARD_FetchOPtions())).json()
        document.getElementById('GUEST-POSTING::instructions-outline').innerHTML = reply.Reply.Outline;
        document.getElementById('GUEST-POSTING::instructions-article').innerHTML = reply.Reply.Article;
        //document.getElementById('GUEST-POSTING::instructions-outline').innerHTML = DASHBOARD_Cookie('GUESTPOSTING::instructions-outline');
        //document.getElementById('GUEST-POSTING::instructions-article').innerHTML = DASHBOARD_Cookie('GUESTPOSTING::instructions-article');
        GUESTPOSTING_Pool()
        let fetch_options  = DASHBOARD_FetchOPtions()  
        fetch_options.body = {};
        let container      = document.getElementById('GUEST-POSTING::audiences-container');
        let src            = document.getElementById('GUEST-POSTING::audiences-template');
        let tones          = await DASHBOARD_Fetch('/outlinegen-get-tones', fetch_options);       
        for (const audience of tones.Audiences) {
            let clone                   = src.content.cloneNode(true);          
            clone.children[0].id        = `GUEST-POSTING::audience-${audience.Audience.replaceAll(" ", "-")}`; 
            clone.children[0].innerHTML = audience.Audience;         
            clone.children[0].value     = audience.Audience;        
            container.appendChild(clone);
            GUESTPOSTING.SetAudienceDescription(audience.Audience, audience.Caption)            
        }  
        container      = document.getElementById('GUEST-POSTING::tones-container');
        src            = document.getElementById('GUEST-POSTING::tones-template'); 
        for (const tone of tones.Tones) {
            let clone                   = src.content.cloneNode(true);          
            clone.children[0].id        = `GUEST-POSTING::tone-${tone.Tone.replaceAll(" ", "-")}`; 
            clone.children[0].innerHTML = tone.Tone;         
            clone.children[0].value     = tone.Tone;        
            container.appendChild(clone);
            GUESTPOSTING.SetToneDescription(tone.Tone, tone.Caption)            
        }  
        DASHBOARD_SetOptions('GUEST-POSTING::audiences-container', 'General Public'); 
        DASHBOARD_SetOptions('GUEST-POSTING::tones-container', 'Professional yet Friendly'); 
    })()
    function GUESTPOSTING_ShowAudienceTip(src){
        let key = src.id.replace('GUEST-POSTING::audience-', '').replaceAll('-', ' ')            
        let tip = GUESTPOSTING.GetAudienceDescription(key);                  
        document.getElementById('GUEST-POSTING::audience-tip').innerHTML     = tip;
        document.getElementById('GUEST-POSTING::audience-tip').style.display = 'block'
    }
    function GUESTPOSTING_ShowToneTip(src){
        let key = src.id.replace('GUEST-POSTING::tone-', '').replaceAll('-', ' ')            
        let tip = GUESTPOSTING.GetToneDescription(key);                  
        document.getElementById('GUEST-POSTING::tone-tip').innerHTML     = tip;
        document.getElementById('GUEST-POSTING::tone-tip').style.display = 'block'
    }
    async function GUESTPOSTING_Pool(){               
        let containers = []
        for (const __id of 
        ['progress-searcher-container', 'progress-outline-container', 'progress-article-container', 'progress-fix-container', 'progress-titles-container']) {  
            let el = document.getElementById('GUEST-POSTING::' + __id)          
            containers.push(el)
            el.children[0].innerHTML = `<div class='GUEST-POSTING_Stopped-Loader'></div>`;
        }                   
        let fetch_options  = DASHBOARD_FetchOPtions()  
        let stoped         = `<div class='GUEST-POSTING_Stopped-Loader'></div>`;
        let running        = `<div class='DASHBOARD_Loader' style='display:flex;width:26px;height:26px;margin-left:0px'></div>`;
        let done           = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="DASHBOARD_icon-yes-medium" style='margin-left:0px;margin-top:4px;'>
            <path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>
        </svg>`
        let current = [stoped, stoped, stoped, stoped, stoped]    
        let reply   = await DASHBOARD_Fetch('/pool?id=GuestPost&CleanUP=true', fetch_options)   
        //console.log(reply)    
        while(reply.Err === 'S_OK'){
            //console.log(reply)
            document.getElementById('GUEST-POSTING::Generate').disabled         = 'disabled'; 
            document.getElementById('GUEST-POSTING::Pool-Dialog').style.display = 'flex'; 
            reply = await DASHBOARD_Fetch('/pool?id=GuestPost&CleanUP=true', fetch_options);   
            console.log(reply)         
            if (reply.Data.Status !== 'Running') {               
                document.getElementById('GUEST-POSTING::generated-content').value   = 
            'Title:' + document.getElementById('GUEST-POSTING::article-title').value + '\n' +
            'Meta description:' + document.getElementById('GUEST-POSTING::meta-desc').value  +'\n' + reply.Data.FinalArticle;
                document.getElementById('GUEST-POSTING::Pool-Dialog').style.display = 'None';
                document.getElementById('GUEST-POSTING::Generate').disabled         = '';    
                return;            
            }              
            let index  = 
            ['Generating Searcher Considerations', 'Generating Outline', 'Generating Article', 'Removing Black Listed Keywords', 'Generating Title Suggestions'].indexOf(reply.Data.CurrentTask);                    
            for (const [idx, container] of containers.entries()) {
                let html = idx === index ? running : idx < index ? done : stoped;
                if (current[idx] !== html) {
                    container.children[0].innerHTML = html;
                    current[idx]                    = html;
                }                 
            }
            new Promise(resolve => setTimeout(resolve, 100));
        }
        document.getElementById('GUEST-POSTING::Pool-Dialog').style.display = 'None';
    }
    function GUESTPOSTING_ToneChanged(){          
        var slct = document.getElementById('GUEST-POSTING::tones-container') ;
        count    = 0;     
        for (option of slct.options) {
            if (option.selected) {
                count += 1
                if (count > 1){
                    option.selected = false;
                    alert('Select only one')
                    return;
                }
            }
        }     
    }
    function GUESTPOSTING_AudienceChanged(src){            
        var slct = document.getElementById('GUEST-POSTING::audiences-container') ;
        count    = 0;     
        for (option of slct.options) {
            if (option.selected) {
                count += 1
                if (count > 1){
                    option.selected = false;
                    alert('Select only one')
                    return;
                }
            }
        }   
    }   
    function GUESTPOSTING_ShowTitleDiag(event){
        document.getElementById('GUEST-POSTING::Title-Dialog').style.display     = 'flex';         
        document.getElementById('GUEST-POSTING::gen-title').disabled             = false;    
        document.getElementById('GUEST-POSTING::title-spinner').style.display    = 'none';
        event.stopPropagation();
        (async function(){
            let select       = document.getElementById('GUEST-POSTING::title-and-meta-prompts')
            select.innerHTML = ''        
            for (const prompt in DASHBOARD_OptionO('More Prompts')['Titles']){            
                let option      = document.createElement('option');
                option.value    = prompt;
                option.label    = prompt;              
                select.appendChild(option);
            }   
        })()  
    } 
    function GUESTPOSTING_Accept(index){
        /*
        curr_title  = document.getElementById(`GUEST-POSTING::article-title`).value.trim();
        suggestions = []
        for (let i = 1; i < 4; i++) {suggestions.push(document.getElementById(`GUEST-POSTING::article-title${i}`).value.trim())}
        if ((curr_title === '') || (suggestions.includes(curr_title))) {
            document.getElementById('GUEST-POSTING::article-title').value = document.getElementById(`GUEST-POSTING::article-title${index}`).value;
        }  
        */      
        document.getElementById('GUEST-POSTING::article-title').value        = document.getElementById(`GUEST-POSTING::article-title${index}`).value;
        document.getElementById('GUEST-POSTING::meta-desc').value            = document.getElementById(`GUEST-POSTING::meta-desc${index}`).value;
        document.getElementById('GUEST-POSTING::Title-Dialog').style.display = 'None';
    }
    function GUESTPOSTING_GenTitleSuggestions(event){
        event.stopPropagation();
        document.getElementById('GUEST-POSTING::gen-title').disabled             = true;    
        document.getElementById('GUEST-POSTING::title-spinner').style.display    = 'flex';
        return AGUESTPOSTING_GenTitleSuggestions()
    }
    async function AGUESTPOSTING_GenTitleSuggestions(){   
        await DASHBOARD_UpdateSettings()        
        if (document.getElementById('GUEST-POSTING::topic').value.trim() === '') {
            document.getElementById('GUEST-POSTING::gen-title').disabled          = false;    
            document.getElementById('GUEST-POSTING::title-spinner').style.display = 'none';
            return alert('No "topic" provided');            
        } 
        let today          = new Date().toDateString().split(' ').slice(1, 4).toString().replace(',', ' ').replace(',', ', '); 
        let prompts        = DASHBOARD_OptionO('More Prompts')['Titles'][document.getElementById('GUEST-POSTING::title-and-meta-prompts').value];
        let fetch_options  = DASHBOARD_FetchOPtions();
        fetch_options.body = JSON.stringify({                    
            Prompts : {'System - only meta' : prompts[0].replace('{Date}', today), 'User - only meta' : prompts[1].replace('{Date}', today), 
            'System' : prompts[2].replace('{Date}', today), 'User' : prompts[3].replace('{Date}', today)},
            anchor_text : document.getElementById('GUEST-POSTING::anchor-text').value,
            target_url  : document.getElementById('GUEST-POSTING::target-url').value,
            title       : document.getElementById('GUEST-POSTING::article-title').value,
            topic       : document.getElementById('GUEST-POSTING::topic').value,
        });        
        let reply = await fetch(`/guest-post_create-title-and-meta`, fetch_options);
        let json  = await reply.json();
        //console.log(json)     
        let title1 = ''
        let desc1  = ''
        let title2 = ''
        let desc2  = ''
        let title3 = ''
        let desc3  = ''
        let curr_title = document.getElementById('GUEST-POSTING::article-title').value.trim();
        console.log(json)
        if (curr_title === '') {
            try{ 
                r      = json.Reply
                title1 = r.split('Title 1:')[1].split('Meta Description 1:')[0]
                desc1  = r.split('Meta Description 1:')[1].split('Title 2:')[0]
                title2 = r.split('Title 2:')[1].split('Meta Description 2:')[0]
                desc2  = r.split('Meta Description 2:')[1].split('Title 3:')[0]
                title3 = r.split('Title 3:')[1].split('Meta Description 3:')[0]
                desc3  = r.split('Meta Description 3:')[1] 
            } catch(error){
                title1 = `${error}`
                desc1  = `${error}`
                title2 = `${error}`
                desc2  = `${error}`
                title3 = `${error}`
                desc3  = `${error}`
            }              
            document.getElementById('GUEST-POSTING::article-title1').value = title1
            document.getElementById('GUEST-POSTING::article-title2').value = title2
            document.getElementById('GUEST-POSTING::article-title3').value = title3
            document.getElementById('GUEST-POSTING::meta-desc1').value  = desc1        
            document.getElementById('GUEST-POSTING::meta-desc2').value  = desc2        
            document.getElementById('GUEST-POSTING::meta-desc3').value  = desc3
        } else {
            try{ 
                r      = json.Reply                
                desc1  = r.split('Meta Description 1:')[1].split('Meta Description 2:')[0]                
                desc2  = r.split('Meta Description 2:')[1].split('Meta Description 3:')[0]                
                desc3  = r.split('Meta Description 3:')[1] 
            } catch(error){                
                desc1  = `${error}`                
                desc2  = `${error}`                
                desc3  = `${error}`
            }              
            document.getElementById('GUEST-POSTING::article-title1').value = curr_title
            document.getElementById('GUEST-POSTING::article-title2').value = curr_title
            document.getElementById('GUEST-POSTING::article-title3').value = curr_title
            document.getElementById('GUEST-POSTING::meta-desc1').value  = desc1        
            document.getElementById('GUEST-POSTING::meta-desc2').value  = desc2        
            document.getElementById('GUEST-POSTING::meta-desc3').value  = desc3
        }
        document.getElementById('GUEST-POSTING::gen-title').disabled          = false;    
        document.getElementById('GUEST-POSTING::title-spinner').style.display = 'none';
    }
    function GUESTPOSTING_SetBusy(msg){
        document.getElementById('GUEST-POSTING::generate-manual').classList             = 'btn btn-danger btn-rounded';
        document.getElementById('GUEST-POSTING::generate-manual-label').innerHTML       = msg;
        document.getElementById('GUEST-POSTING::generate-manual-spinner').style.display = 'flex';
        document.getElementById('GUEST-POSTING::redo-label').innerHTML                  = '';
        document.getElementById('GUEST-POSTING::redo').disabled                         = true;
    }
    function GUESTPOSTING_SetIdle(msg, redomsg){
        document.getElementById('GUEST-POSTING::generate-manual').classList             = 'btn btn-az-secondary btn-rounded';
        document.getElementById('GUEST-POSTING::generate-manual-label').innerHTML       = msg;
        document.getElementById('GUEST-POSTING::generate-manual-spinner').style.display = 'none';
        document.getElementById('GUEST-POSTING::redo-label').innerHTML                  = redomsg;
        document.getElementById('GUEST-POSTING::redo').disabled                         = '';
    }
    function GUESTPOSTING_StartManual(){        
        GUESTPOSTING_SetBusy('Generating searcher considerations');        
        (async function(){            
            let options = DASHBOARD_FetchOPtions();
            options.body = JSON.stringify({                    
                ArticleTitle  : document.getElementById('GUEST-POSTING::article-title').value, 
                Models : {                   
                    'Entities' : DASHBOARD_GetModel('Entities'),                        
                },                   
            });
            let considerations = (await DASHBOARD_Fetch('/guest-post_create-considerations', options)).Reply;  
            document.getElementById('GUEST-POSTING::generated-content').value = considerations;              
            GUESTPOSTING_SetIdle('Continue - outline', 'Redo - semantic analysis');           
            document.getElementById('GUEST-POSTING::redo').onclick = function(){GUESTPOSTING_StartManual();}
            document.getElementById('GUEST-POSTING::generate-manual').onclick = function(){GUESTPOSTING_CreateOutline(considerations);}          
        })();    
    }
    function GUESTPOSTING_CreateOutline(samantic_analysis, prev_instructions){
        GUESTPOSTING_SetBusy('Generating outline');        
        (async function(){     
            try {      
                if (DASHBOARD_GetOptions('GUEST-POSTING::audiences-container').length === 0) {
                    alert('Please select the audience');
                    GUESTPOSTING_SetIdle('Continue - outline', 'Redo - considerations');  
                    return;
                }
                if (DASHBOARD_GetOptions('GUEST-POSTING::tones-container').length === 0) {
                    GUESTPOSTING_SetIdle('Continue - outline', 'Redo - considerations');  
                    alert('Please select the tone');
                    return; 
                }            
                let instructions = prev_instructions === undefined ? document.getElementById('GUEST-POSTING::instructions-outline').value : prev_instructions;
                instructions     = document.getElementById('GUEST-POSTING::instructions-outline').value;
                let options      = DASHBOARD_FetchOPtions();
                //let samantic_analysis = document.getElementById('GUEST-POSTING::generated-content').value;
                let considerations = '' 
                try {
                    considerations = samantic_analysis.split('Searcher Considerations:')[1].split('Attributes:')[0].trim();
                } catch (error) {
                    considerations = String(error);
                }            
                options.body = JSON.stringify({                       
                    'ArticleTitle'          : document.getElementById('GUEST-POSTING::article-title').value,                 
                    'Audience'              : DASHBOARD_GetOptions('GUEST-POSTING::audiences-container')[0],
                    'Tones'                 : DASHBOARD_GetOptions('GUEST-POSTING::tones-container')[0],
                    'SpecialInstructions'   : instructions,
                    'Model'                 : DASHBOARD_GetModel('outline-generation'),    
                    'Considerations'        : considerations,    
                    'SemanticAnalysis'      : samantic_analysis, 
                    GuestPostingPrompts     : await GUESTPOSTING_GetPrompts(),
                    BlackListExclusions     : document.getElementById('GUEST-POSTING::black-list-exlusions').value.replaceAll("\n", '@'),
                    Today                   : new Date().toDateString().split(' ').slice(1, 4).toString().replace(',', ' ').replace(',', ', ')                                
                });
                let outline = (await DASHBOARD_Fetch('/guest-post_create-outline', options)).Reply;  
                document.getElementById('GUEST-POSTING::generated-content').value = outline;   
                GUESTPOSTING_SetIdle('Continue - aticle', 'Redo - outline');           
                document.getElementById('GUEST-POSTING::redo').onclick = function(){GUESTPOSTING_CreateOutline(samantic_analysis, instructions);}
                document.getElementById('GUEST-POSTING::generate-manual').onclick = function(){GUESTPOSTING_CreateArticle(samantic_analysis);}               
                } catch(err){
                    DASHBOARD_except(err)
                    GUESTPOSTING_SetIdle('Continue - outline', 'Redo - semantic analysis');           
                    return;
                }                                   
        })();    
    }
    function GUESTPOSTING_CreateArticle(samantic_analysis, prev_outline){
        GUESTPOSTING_SetBusy('Generating article');        
        (async function(){   
            let templates     = DASHBOARD_OptionO('More Prompts')['Fix content'][document.getElementById('GUEST-POSTING::fix-prompts').value];            
            let template_vars = {
                TONES    : DASHBOARD_OptionA('Selected Tones'),
                AUDIENCE : DASHBOARD_Option('Selected Audience')
            }
            let prompts   = {
                'AI Words - System'         : DASHBOARD_ExpandPrompt(template_vars, templates[0]),
                'AI Words - User'           : DASHBOARD_ExpandPrompt(template_vars, templates[1]),
                'Self referencing - System' : DASHBOARD_ExpandPrompt(template_vars, templates[2]),
                'Self referencing - User'   : DASHBOARD_ExpandPrompt(template_vars, templates[3]),
                'Bold words - System'       : DASHBOARD_ExpandPrompt(template_vars, templates[4]),
                'Bold words - User'         : DASHBOARD_ExpandPrompt(template_vars, templates[5]),
            }  
            let considerations = '' 
            try {
                considerations = samantic_analysis.split('Searcher Considerations:')[1].split('Attributes:')[0].trim();
            } catch (error) {
                considerations = String(error);
            }
            
            let outline = prev_outline === undefined ? document.getElementById('GUEST-POSTING::generated-content').value : prev_outline;
            let options = DASHBOARD_FetchOPtions();
            options.body = JSON.stringify({                       
                'MetaDescription'       : document.getElementById('GUEST-POSTING::meta-desc').value,
                'ArticleTitle'          : document.getElementById('GUEST-POSTING::article-title').value,
                'AnchorText'            : document.getElementById('GUEST-POSTING::anchor-text').value,
                'TargetURL'             : document.getElementById('GUEST-POSTING::target-url').value,
                'Audience'              : DASHBOARD_GetOptions('GUEST-POSTING::audiences-container')[0],
                'Tones'                 : DASHBOARD_GetOptions('GUEST-POSTING::tones-container')[0],
                'Considerations'        : considerations,
                'SemanticAnalysis'      : samantic_analysis,
                'SpecialInstructions'   : document.getElementById('GUEST-POSTING::instructions-article').value,
                'Model'                 : DASHBOARD_GetModel('guest-article'),                
                'FixModel'     : DASHBOARD_GetModel('black-list'),
                'Improve'      : DASHBOARD_GetModel('improve-content'),
                'Highlight'    : document.getElementById('GUEST-POSTING::highlight-after-improve').checked === true ? 'HIGHLIGHT' : '',    
                'HModel'       : DASHBOARD_GetModel('highlight'),  
                'Model2ndPass' : DASHBOARD_GetModel('black-list-2nd'), 
                SelfReferecing : DASHBOARD_GetModel('self-referecing'),
                Outline        : outline,
                Today          : new Date().toDateString().split(' ').slice(1, 4).toString().replace(',', ' ').replace(',', ', '),  
                Prompts        : prompts,
                GuestPostingPrompts : await GUESTPOSTING_GetPrompts(),
                BlackListExclusions : document.getElementById('GUEST-POSTING::black-list-exlusions').value.replaceAll("\n", '@')                                            
            });
            let article = (await DASHBOARD_Fetch('/guest-post_create-article', options)).Reply;  
            document.getElementById('GUEST-POSTING::generated-content').value = 
            'Title:' + document.getElementById('GUEST-POSTING::article-title').value + '\n' +
            'Meta description:' + document.getElementById('GUEST-POSTING::meta-desc').value  +'\n' + article;              
            GUESTPOSTING_SetIdle('Generate - manual', 'Redo - article');           
            document.getElementById('GUEST-POSTING::redo').onclick = function(){GUESTPOSTING_CreateArticle(considerations, outline);}
            document.getElementById('GUEST-POSTING::generate-manual').onclick = function(){GUESTPOSTING_StartManual();}            
        })();    
    }
    function GUESTPOSTING_SetDefault(_this, whitch){
        _this.disabled = true;        
        let options = DASHBOARD_FetchOPtions();
        options.body = JSON.stringify({                       
            'whitch'     : whitch,
            'value'      : document.getElementById(`GUEST-POSTING::instructions-${whitch.toLowerCase()}`).value,
            'SettingsID' : DASHBOARD_GUID('Settings')
        });
        let value   = document.getElementById(`GUEST-POSTING::instructions-${whitch.toLowerCase()}`).value;
        (async function(){   
            let reply = await (await fetch(`/guest-post_set-default?whitch=${whitch}&value=${value}&SettingsID=${DASHBOARD_GUID('Settings')}`, options)).json()
            console.log(reply)
        })();
        _this.disabled = false;
        return
       document.cookie = 
       `GUESTPOSTING::instructions-${whitch.toLowerCase()}=${document.getElementById(`GUEST-POSTING::instructions-${whitch.toLowerCase()}`).value};max-age=max-age-in-seconds=${60*60*24*365};`
        _this.disabled = false;
    }
    async function GUESTPOSTING_GetPrompts(){
        await DASHBOARD_UpdateSettings()
        let templates = 
        DASHBOARD_OptionO('More Prompts')['Guest posting'][document.getElementById('GUEST-POSTING::outline-and-article-prompts').value];
        return {'Outline System' : templates[0], 'Outline User' : templates[1], 'Article System' : templates[2], 'Article User' : templates[3]};
        cnosole.log(templates)
    }
    function GUESTPOSTING_FixPromptChanged(_this){
        document.cookie = `GUESTPOSTING::FixPrompt=${_this.value};max-age=max-age-in-seconds=${60*60*24*365};`
    }
    function GUESTPOSTING_OutlinePromptChanged(_this){        
        document.cookie = `GUESTPOSTING::OutlineAndArticlePrompt=${_this.value};max-age=max-age-in-seconds=${60*60*24*365};`
    }
    function GUESTPOSTING_BlackListExclusionsChanged(_this){       
        console.log(_this.value)
        document.cookie = `GUESTPOSTING::BlackListExclusions=${_this.value.replaceAll('\n', "@")};max-age=max-age-in-seconds=${60*60*24*365};`
    }
</script>    
    {% else %}
        <h1 class='az-content-title DASHBOARD_Noaccess'>You don't have access to this tool</h1>
    {% endif %}    
{% endblock %}
